- name: Gemini AI
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
    run: |
      git diff HEAD^ HEAD > diff.txt
      # We keep the prompt simple to avoid regional filtering
      PROMPT="You are a Senior Architect. Review this Next.js 16/Tailwind v4 code. List 3 technical improvements. Diff: $(cat diff.txt | head -c 4000)"
      
      # Using the 2026 'Gemini 3 Flash' preview model
      jq -n --arg msg "$PROMPT" \
      '{
        contents: [{ parts: [{ text: $msg }] }],
        generationConfig: { "thinkingLevel": "minimal" }
      }' > p.json
      
      # Notice we use v1beta but with the gemini-3-flash-preview model name
      curl -s -X POST "https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${GEMINI_API_KEY}" \
        -H 'Content-Type: application/json' \
        -d @p.json > res.json
      
      echo "--- 2026 API DEBUG ---"
      cat res.json